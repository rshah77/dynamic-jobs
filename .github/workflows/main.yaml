name: main

on:
  # Trigger the workflow on push or pull request,
  # but only for the main branch
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
      
jobs:
  test_job:
    name: My first job
    runs-on: ubuntu-latest
    outputs:
      output1: ${{ steps.step3.outputs.plugin }}
    steps:
    - name: checkout repo
      uses: actions/checkout@v2
      
    - name: list direcotry contents
      run: ls -al
    
    - id: step3
      name: get plugins list from plugins yaml
      run: |
        PLUGINS=$(yq eval .plugins plugins.yaml)"
        echo "::set-output name=plugin::$PLUGINS"
      shell: bash
  
  call_workflow:
    needs: test_job
    uses: LeiZhaoGFT/dynamic-jobs/.github/workflows/plugin_template.yaml@main
    with:
      plugin_types: echo ${{needs.test_job.outputs.output1}}
    

